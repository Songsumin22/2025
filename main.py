# mbti_travel.py
# ğŸŒ MBTI ìœ í˜•ë³„ ì—¬í–‰ ì¶”ì²œ ì›¹ (ì§€ë„ + ì¼ì • ìë™ ìƒì„±)
# pip install streamlit folium streamlit-folium pandas

import streamlit as st
import folium
from streamlit_folium import st_folium
import pandas as pd
from datetime import date, timedelta
import random
import io

st.set_page_config(page_title="MBTI ì—¬í–‰ ì¶”ì²œ", page_icon="ğŸŒ", layout="wide")

# -----------------------------
# ë°ì´í„°: 16ê°œ MBTI ìœ í˜•ë³„ ì¶”ì²œ
# ê° ëª©ì ì§€ëŠ” (ë„ì‹œ, ë‚˜ë¼, ìœ„ë„, ê²½ë„)
# -----------------------------
DATA = {
    "INTJ": {
        "style": "ì¡°ìš©í•˜ê³  ê¹Šì´ ìˆëŠ” ë¬¸í™” íƒë°©",
        "description": "ê¹Šì´ ìˆëŠ” ì—­ì‚¬Â·ê±´ì¶•Â·ì„œì Â·ë°•ë¬¼ê´€ì„ ì‚¬ë‘í•˜ëŠ” INTJì—ê²Œ ì˜ ë§ëŠ” ì—¬í–‰.",
        "destinations": [
            ("êµí† ", "ì¼ë³¸", 35.0116, 135.7681),
            ("í”„ë¼í•˜", "ì²´ì½”", 50.0755, 14.4378),
            ("í”¼ë Œì²´", "ì´íƒˆë¦¬ì•„", 43.7696, 11.2558),
        ],
        "activities": [
            "í˜„ì§€ ì„œì Â·ì „í†µ ì°»ì§‘ì—ì„œ ì‚¬ìƒ‰",
            "ê±´ì¶• íˆ¬ì–´ ë° ë°•ë¬¼ê´€ ê´€ëŒ",
            "í•œì í•œ ê³¨ëª© ì‚¬ì§„ ì‚°ì±…",
            "ì‚¬ì›/ì„±ë‹¹ì˜ ì•„ì¹¨ ë°©ë¬¸",
            "í´ë˜ì‹ ê³µì—° ê°ìƒ",
        ],
    },
    "INTP": {
        "style": "ì§€ì  í˜¸ê¸°ì‹¬ ì¶©ì¡±, ì°¨ë¶„í•œ ë„ì‹œ ì‚°ì±…",
        "description": "í•™ë¬¸ê³¼ ê³¼í•™, ì‚¬ìƒ‰ì˜ ë¦¬ë“¬ì„ ìœ ì§€í•  ìˆ˜ ìˆëŠ” ê³³ ìœ„ì£¼.",
        "destinations": [
            ("íƒˆë¦°", "ì—ìŠ¤í† ë‹ˆì•„", 59.4370, 24.7536),
            ("ì¼€ì„ë¸Œë¦¬ì§€", "ì˜êµ­", 52.2053, 0.1218),
            ("ì·¨ë¦¬íˆ", "ìŠ¤ìœ„ìŠ¤", 47.3769, 8.5417),
        ],
        "activities": [
            "ëŒ€í•™ ìº í¼ìŠ¤/ë°•ë¬¼ê´€ íƒë°©",
            "ê³¼í•™Â·ê¸°ìˆ  ì „ì‹œ ê´€ëŒ",
            "ê°•ë³€ ì‚°ì±…ê³¼ ìŠ¤ì¼€ì¹˜",
            "í˜„ì§€ ì¹´í˜ì—ì„œ ë…ì„œ",
            "í˜„ì§€ ë„ì„œê´€Â·ì•„ì¹´ì´ë¸Œ ì²´í—˜",
        ],
    },
    "ENTJ": {
        "style": "íš¨ìœ¨ì ì¸ ë„ì‹œ ì •ë³µ, ë¹„ì¦ˆÂ·ëª¨ë˜ ì»¬ì²˜",
        "description": "ëŒ€ë„ì‹œì˜ ì†ë„ê°, ëœë“œë§ˆí¬ì™€ ë¯¸ì‹, ê¹”ë”í•œ ë™ì„ .",
        "destinations": [
            ("ì‹±ê°€í¬ë¥´", "ì‹±ê°€í¬ë¥´", 1.3521, 103.8198),
            ("ë‰´ìš•", "ë¯¸êµ­", 40.7128, -74.0060),
            ("ë² ë¥¼ë¦°", "ë…ì¼", 52.5200, 13.4050),
        ],
        "activities": [
            "ì£¼ìš” ëœë“œë§ˆí¬ ì „ê´‘ì„í™” íˆ¬ì–´",
            "ë£¨í”„íƒ‘/ë¯¸ì‰ë¦° ë¯¸ì‹",
            "í˜„ëŒ€ë¯¸ìˆ ê´€Â·ì „ì‹œ ê´€ëŒ",
            "ì•¼ê²½ ìŠ¤ì¹´ì´ë¼ì¸ ê°ìƒ",
            "íš¨ìœ¨ ë£¨íŠ¸ ì§€í•˜ì²  ë§ˆìŠ¤í„°",
        ],
    },
    "ENTP": {
        "style": "ìƒˆë¡œì›€Â·ì•„ì´ë””ì–´ í­ë°œ, íŠ¸ë Œë”” ì‹¤í—˜",
        "description": "ë³€í™”ë¥¼ ì¦ê¸°ë©° ì‹ ë°•í•œ ì²´í—˜ê³¼ ëŒ€í™”ê°€ ë§ì€ ë™ì„ .",
        "destinations": [
            ("ë„ì¿„", "ì¼ë³¸", 35.6762, 139.6503),
            ("í…”ì•„ë¹„ë¸Œ", "ì´ìŠ¤ë¼ì—˜", 32.0853, 34.7818),
            ("ìƒŒí”„ë€ì‹œìŠ¤ì½”", "ë¯¸êµ­", 37.7749, -122.4194),
        ],
        "activities": [
            "ìŠ¤íƒ€íŠ¸ì—… ê±°ë¦¬/ë©”ì´ì»¤ìŠ¤í˜ì´ìŠ¤ ë°©ë¬¸",
            "ì´ìƒ‰ í…Œë§ˆ ì¹´í˜ íˆ¬ì–´",
            "ì–¸ë”ê·¸ë¼ìš´ë“œ ì „ì‹œ/ê³µì—°",
            "ê³¨ëª© ìƒì  íƒí—˜",
            "í˜„ì§€ì¸ í† ë¡  ëª¨ì„Â·ë°‹ì—…",
        ],
    },
    "INFJ": {
        "style": "ì˜ê°ì„ ì£¼ëŠ” ê³ ìš”í•¨, í’ê²½Â·ì‚¬ìƒ‰",
        "description": "í‰í™”ë¡œìš´ í’ê²½ê³¼ ê¹Šì€ ì´ì•¼ê¸°ì˜ ì—¬ì •.",
        "destinations": [
            ("ì‚°í† ë¦¬ë‹ˆ", "ê·¸ë¦¬ìŠ¤", 36.3932, 25.4615),
            ("ë ˆì´ìº¬ë¹„í¬", "ì•„ì´ìŠ¬ë€ë“œ", 64.1466, -21.9426),
            ("ë¸”ë ˆë“œí˜¸", "ìŠ¬ë¡œë² ë‹ˆì•„", 46.3692, 14.1136),
        ],
        "activities": [
            "ì¼ì¶œ/ì¼ëª° ëª…ì†Œ ì‚¬ìƒ‰",
            "ìì—° ì† ëª…ìƒ ì‚°ì±…",
            "í˜„ì§€ ì˜ˆìˆ ê°€ ê°¤ëŸ¬ë¦¬ ë°©ë¬¸",
            "ì˜¨ì²œ/ìŠ¤íŒŒ íë§",
            "ì‘ì€ ë§ˆì„ ì±…ë°© ì°¾ê¸°",
        ],
    },
    "INFP": {
        "style": "ê°ì„± ì¶©ë§Œ ìŠ¤í† ë¦¬ ì—¬í–‰",
        "description": "ë¬¸í•™Â·ê°ì„± ì¹´í˜Â·ê³¨ëª© ì´ì•¼ê¸°ë¡œ ì±„ìš°ëŠ” ë£¨íŠ¸.",
        "destinations": [
            ("ì—ë“ ë²„ëŸ¬", "ì˜êµ­", 55.9533, -3.1883),
            ("ë¥˜ë¸”ë´ë‚˜", "ìŠ¬ë¡œë² ë‹ˆì•„", 46.0569, 14.5058),
            ("ì¹˜ì•™ë§ˆì´", "íƒœêµ­", 18.7883, 98.9853),
        ],
        "activities": [
            "ë¬¸í•™ ëª…ì†ŒÂ·ì¤‘ê³ ì„œì  íˆ¬ì–´",
            "ìˆ˜ê³µì˜ˆ ì›Œí¬ìˆ ì²´í—˜",
            "í˜„ì§€ ì¹´í˜Â·ë””ì €íŠ¸ ì„±ì§€ìˆœë¡€",
            "ê³¨ëª© ì‚¬ì§„ ì‚°ì±…",
            "ìì„  ë§ˆì¼“/ì»¤ë®¤ë‹ˆí‹° ë°©ë¬¸",
        ],
    },
    "ENFJ": {
        "style": "ì‚¬ëŒ ì¤‘ì‹¬, ë”°ëœ»í•œ ë„ì‹œ ê²½í—˜",
        "description": "ì»¤ë®¤ë‹ˆí‹°Â·ê³µê³µê³µê°„Â·ë¡œì»¬ ìŠ¤í† ë¦¬ê°€ í’ë¶€í•œ ê³³.",
        "destinations": [
            ("ì„œìš¸", "ëŒ€í•œë¯¼êµ­", 37.5665, 126.9780),
            ("ë°´ì¿ ë²„", "ìºë‚˜ë‹¤", 49.2827, -123.1207),
            ("ì½”íœí•˜ê²", "ë´ë§ˆí¬", 55.6761, 12.5683),
        ],
        "activities": [
            "ë¡œì»¬ ë§ˆì¼“Â·í”Œë¦¬ë§ˆì¼“ íƒë°©",
            "ì»¤ë®¤ë‹ˆí‹° ì„¼í„° í”„ë¡œê·¸ë¨ ì°¸ì—¬",
            "ë„ì‹œ ê³µì› í”¼í¬ë‹‰",
            "ì‚¬íšŒì ê¸°ì—… ì¹´í˜ ë°©ë¬¸",
            "ë””ìì¸/ê±´ì¶• íˆ¬ì–´",
        ],
    },
    "ENFP": {
        "style": "í™œë°œí•œ ì²´í—˜ + ë‹¤ë¬¸í™” êµë¥˜",
        "description": "ììœ ë¡œìš´ ì—ë„ˆì§€ì™€ ì¶•ì œ, ê±°ë¦¬ì˜ ì»¬ëŸ¬.",
        "destinations": [
            ("ë°”ë¥´ì…€ë¡œë‚˜", "ìŠ¤í˜ì¸", 41.3851, 2.1734),
            ("ë°©ì½•", "íƒœêµ­", 13.7563, 100.5018),
            ("ë¦¬ìš°ë°ìë„¤ì´ë£¨", "ë¸Œë¼ì§ˆ", -22.9068, -43.1729),
        ],
        "activities": [
            "ê¸¸ê±°ë¦¬ ê³µì—°/ì¶•ì œ ì¦ê¸°ê¸°",
            "í˜„ì§€ ìš”ë¦¬ í´ë˜ìŠ¤",
            "ììœ  ì¼ì •ìœ¼ë¡œ ê³¨ëª© íƒí—˜",
            "ë¹„ì¹˜/ë£¨í”„íƒ‘ ë¼ìš´ì§€",
            "í˜„ì§€ ì¹œêµ¬ ì‚¬ê·€ê¸° ë¯¸ì…˜",
        ],
    },
    "ISTJ": {
        "style": "ì§ˆì„œì •ì—°í•œ í´ë˜ì‹ ì—¬í–‰",
        "description": "ì •í™•í•œ ë™ì„ Â·ì‹œê°„í‘œÂ·í´ë˜ì‹ ëª…ì†Œ ì¤‘ì‹¬.",
        "destinations": [
            ("ë¹ˆ", "ì˜¤ìŠ¤íŠ¸ë¦¬ì•„", 48.2082, 16.3738),
            ("ë®Œí—¨", "ë…ì¼", 48.1351, 11.5820),
            ("ì½”íœí•˜ê²", "ë´ë§ˆí¬", 55.6761, 12.5683),
        ],
        "activities": [
            "ì •ì‹œ ì¶œë°œ ì‹œí‹°íˆ¬ì–´",
            "ê³ ì „ ìŒì•…íšŒ ê°ìƒ",
            "ì™•ê¶/ê¶ì „ ê²¬í•™",
            "ì „í†µ ë ˆìŠ¤í† ë‘ ì˜ˆì•½ ì‹ì‚¬",
            "ìœ ëª… ë°•ë¬¼ê´€ ë¼ì¸ì—…",
        ],
    },
    "ISFJ": {
        "style": "ì•„ëŠ‘Â·ì •ê°ˆ, ë™í™” ê°™ì€ ë„ì‹œ",
        "description": "ì•ˆì •ê°ê³¼ ë”°ëœ»í•œ í’ê²½, ì†Œë°•í•œ ê°ë™.",
        "destinations": [
            ("ë¸Œë¤¼í—¤", "ë²¨ê¸°ì—", 51.2093, 3.2247),
            ("ì˜ì¸ ë¶€ë¥´í¬", "ì˜¤ìŠ¤íŠ¸ë¦¬ì•„", 47.8095, 13.0550),
            ("í€˜ë²¡ì‹œí‹°", "ìºë‚˜ë‹¤", 46.8139, -71.2080),
        ],
        "activities": [
            "ë§ˆì°¨/ìš´í•˜ ë³´íŠ¸ ì²´í—˜",
            "í¬ë¦¬ìŠ¤ë§ˆìŠ¤/ì‹œì¦Œ ë§ˆì¼“",
            "í˜„ì§€ ê°€ì •ì‹/ë¹„ìŠ¤íŠ¸ë¡œ",
            "ì‘ì€ ë°•ë¬¼ê´€Â·ê³µë°© ë°©ë¬¸",
            "í•œì í•œ ê³µì› ì‚°ì±…",
        ],
    },
    "ESTJ": {
        "style": "íƒ„íƒ„í•œ ëœë“œë§ˆí¬ ì¤‘ì‹¬ ëŒ€ë„ì‹œ",
        "description": "ì •ë¦¬ëœ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ í•µì‹¬ë§Œ ê½‰.",
        "destinations": [
            ("ëŸ°ë˜", "ì˜êµ­", 51.5074, -0.1278),
            ("í™ì½©", "í™ì½©", 22.3193, 114.1694),
            ("ì‹œì¹´ê³ ", "ë¯¸êµ­", 41.8781, -87.6298),
        ],
        "activities": [
            "í•„ìˆ˜ ëœë“œë§ˆí¬ ì²´í¬",
            "ê°•ë ¥ ë¯¸ì‹ ìŠ¤í¿ ì˜ˆì•½",
            "ë®¤ì§€ì»¬/ì½˜ì„œíŠ¸ ê´€ëŒ",
            "ë¦¬ë²„ í¬ë£¨ì¦ˆ",
            "ìŠ¤ì¹´ì´ë±Â·ì „ë§ëŒ€",
        ],
    },
    "ESFJ": {
        "style": "ì‚¬êµì Â·ë”°ëœ»í•œ íœ´ì‹í˜• ë„ì‹œ",
        "description": "ì¹œí™”ë ¥ ë†’ê³  í¸ì˜ ì¢‹ì€ ê³³ì—ì„œ ì—¬ìœ ë¡­ê²Œ.",
        "destinations": [
            ("íŒŒë¦¬", "í”„ë‘ìŠ¤", 48.8566, 2.3522),
            ("ì‹œë“œë‹ˆ", "í˜¸ì£¼", -33.8688, 151.2093),
            ("íƒ€ì´ë² ì´", "ëŒ€ë§Œ", 25.0330, 121.5654),
        ],
        "activities": [
            "ë¸ŒëŸ°ì¹˜ ì¹´í˜Â·ë§ˆì¹´ë¡± íˆ¬ì–´",
            "ì•„ì´ì½”ë‹‰ í¬í† ìŠ¤íŒŸ",
            "ê°•ë³€/í•´ë³€ ì‚°ì±…",
            "í”Œë¦¬ë§ˆì¼“Â·ë°±í™”ì  ì‡¼í•‘",
            "ì•¼ê°„ ë¼ì´íŠ¸ì—… ëª…ì†Œ",
        ],
    },
    "ISTP": {
        "style": "ìì—°Â·ì•¡í‹°ë¹„í‹° ì¤‘ì‹¬",
        "description": "ì•¼ì™¸í™œë™ê³¼ ë„ì „, ë“œë¼ì´ë¸Œ ë£¨íŠ¸.",
        "destinations": [
            ("í€¸ìŠ¤íƒ€ìš´", "ë‰´ì§ˆëœë“œ", -45.0312, 168.6626),
            ("ì¸í„°ë¼ì¼„", "ìŠ¤ìœ„ìŠ¤", 46.6863, 7.8632),
            ("íŠ¸ë¡¬ì‡ ", "ë…¸ë¥´ì›¨ì´", 69.6492, 18.9553),
        ],
        "activities": [
            "í•˜ì´í‚¹/íŒ¨ëŸ¬ê¸€ë¼ì´ë”©",
            "ë¹™í•˜Â·í˜¸ìˆ˜ íˆ¬ì–´",
            "ì˜¤ë¡œë¼/ë³„ ë³´ê¸°",
            "ìì „ê±°/ì¹´ì•½",
            "ì‚°ì•… ì—´ì°¨ íƒ€ê¸°",
        ],
    },
    "ISFP": {
        "style": "ì˜ˆìˆ ê°ì„±Â·ìì—° ì¹˜ë£Œ",
        "description": "ìì—°ê³¼ ì˜ˆìˆ ì´ ê³µì¡´í•˜ëŠ” ì—¬ìœ ë¡œìš´ ì½”ìŠ¤.",
        "destinations": [
            ("ìš°ë¶“", "ì¸ë„ë„¤ì‹œì•„ ë°œë¦¬", -8.5069, 115.2625),
            ("ë¦¬ìŠ¤ë³¸", "í¬ë¥´íˆ¬ê°ˆ", 38.7223, -9.1393),
            ("í˜¸ì´ì•ˆ", "ë² íŠ¸ë‚¨", 15.8801, 108.3380),
        ],
        "activities": [
            "ìš”ê°€/ëª…ìƒ ë¦¬íŠ¸ë¦¿",
            "í˜„ì§€ ê³µì˜ˆ ì›Œí¬ìˆ",
            "í•´ë³€ ì¼ëª° ê°ìƒ",
            "ì†Œê·œëª¨ ë¼ì´ë¸Œ ê³µì—°",
            "ì „í†µì‹œì¥ ë¯¸ì‹",
        ],
    },
    "ESTP": {
        "style": "ìŠ¤ë¦´Â·ë†€ì´Â·ì´ë²¤íŠ¸",
        "description": "ì§œë¦¿í•œ ì•¡í‹°ë¹„í‹°ì™€ ì•¼ê°„ ì—”í„°í…Œì¸ë¨¼íŠ¸.",
        "destinations": [
            ("ë¼ìŠ¤ë² ì´ê±°ìŠ¤", "ë¯¸êµ­", 36.1699, -115.1398),
            ("ë‘ë°”ì´", "ì•„ëì—ë¯¸ë¦¬íŠ¸", 25.2048, 55.2708),
            ("ì¹¸ì¿¤", "ë©•ì‹œì½”", 21.1619, -86.8515),
        ],
        "activities": [
            "í…Œë§ˆíŒŒí¬/ì‡¼ ê´€ëŒ",
            "ì‚¬ë§‰ ì‚¬íŒŒë¦¬/ìƒŒë“œë³´ë”©",
            "ìš”íŠ¸/ìŠ¤ë…¸í´ë§",
            "ë£¨í”„íƒ‘Â·í´ëŸ½",
            "ìŠˆí¼ì¹´ ì²´í—˜",
        ],
    },
    "ESFP": {
        "style": "ì¶•ì œÂ·ë¹„ì¹˜Â·í¬í†  ìŠ¤íŒŸ",
        "description": "í™”ë ¤í•˜ê³  ì¬ë°ŒëŠ” ìˆœê°„ ìˆ˜ì§‘ê°€ë¥¼ ìœ„í•œ ì½”ìŠ¤.",
        "destinations": [
            ("ë§ˆì´ì• ë¯¸", "ë¯¸êµ­", 25.7617, -80.1918),
            ("ì´ë¹„ì", "ìŠ¤í˜ì¸", 38.9067, 1.4206),
            ("í‘¸ì¼“", "íƒœêµ­", 7.8804, 98.3923),
        ],
        "activities": [
            "í•´ë³€ ì•¡í‹°ë¹„í‹°",
            "ì„ ì…‹ í¬ë£¨ì¦ˆ",
            "ë‚˜ì´íŠ¸ ë¼ì´í”„",
            "ì¸ìƒìƒ· ìŠ¤íŒŸ íˆ¬ì–´",
            "í•´ì‚°ë¬¼ ë¯¸ì‹",
        ],
    },
}

# ëŒ€í‘œ ì´ë¯¸ì§€ (ì €ì‘ê¶Œ ì•ˆì „ì„ ìœ„í•´ ìœ„í‚¤ë¯¸ë””ì–´/ë„ì‹œ ì•„ì´ì½˜ ëŠë‚Œì˜ ê³µê°œ ì´ë¯¸ì§€ URL ì‚¬ìš© ê¶Œì¥)
DEFAULT_IMAGES = {
    "êµí† ": "https://upload.wikimedia.org/wikipedia/commons/6/6e/Kiyomizu-dera_in_Kyoto.jpg",
    "í”„ë¼í•˜": "https://upload.wikimedia.org/wikipedia/commons/a/a6/Prague_old_town_square_panorama.jpg",
    "í”¼ë Œì²´": "https://upload.wikimedia.org/wikipedia/commons/a/a8/Florence_Duomo_III.jpg",
    "ë°”ë¥´ì…€ë¡œë‚˜": "https://upload.wikimedia.org/wikipedia/commons/6/6a/Sagrada_Familia_01.jpg",
    "ë°©ì½•": "https://upload.wikimedia.org/wikipedia/commons/7/7c/Bangkok_Montage_2021.jpg",
    "ë¦¬ìš°ë°ìë„¤ì´ë£¨": "https://upload.wikimedia.org/wikipedia/commons/1/19/Rio_de_Janeiro_-_Rafael_Defavari.jpg",
    # í•„ìš” ì‹œ ë” ì¶”ê°€ ê°€ëŠ¥
}

# -----------------------------
# ìœ í‹¸ í•¨ìˆ˜
# -----------------------------
def get_all_mbti():
    return sorted(DATA.keys())

def build_map(destinations):
    # ì¤‘ì‹¬ì„ ì²« ëª©ì ì§€ë¡œ
    center_lat = destinations[0][2]
    center_lon = destinations[0][3]
    fmap = folium.Map(location=[center_lat, center_lon], zoom_start=4, tiles="CartoDB positron")
    coords = []
    for city, country, lat, lon in destinations:
        folium.Marker(
            [lat, lon],
            popup=f"{city}, {country}",
            tooltip=f"{city}",
        ).add_to(fmap)
        coords.append((lat, lon))
    # ê²½ë¡œ í´ë¦¬ë¼ì¸
    if len(coords) > 1:
        folium.PolyLine(coords, weight=3, opacity=0.7).add_to(fmap)
    return fmap

def sample_destinations(mbti, count=2):
    lst = DATA[mbti]["destinations"]
    if count >= len(lst):
        return lst
    return random.sample(lst, count)

def generate_itinerary(mbti, days, base_date, selected_destinations):
    acts = DATA[mbti]["activities"]
    style = DATA[mbti]["style"]
    rows = []
    for i in range(days):
        day_date = base_date + timedelta(days=i)
        # ëª©ì ì§€ëŠ” ìˆœí™˜ ë°°ì •
        city, country, lat, lon = selected_destinations[i % len(selected_destinations)]
        # í™œë™ì€ ëœë¤ 3ê°œ ë½‘ê¸° (ì•„ì¹¨/ë‚®/ì €ë…)
        day_acts = random.sample(acts, k=min(3, len(acts)))
        morning = f"[ì•„ì¹¨] {day_acts[0]}"
        afternoon = f"[ì˜¤í›„] {day_acts[1] if len(day_acts)>1 else 'ììœ  ì¼ì •'}"
        evening = f"[ì €ë…] {day_acts[2] if len(day_acts)>2 else 'ì•¼ê²½ ì‚°ì±…'}"
        meals = "í˜„ì§€ ìŒì‹ ë§›ë³´ê¸°(ë¡œì»¬ ì‹ë‹¹/ë§ˆì¼“)"
        rows.append({
            "ì¼ì": day_date.strftime("%Y-%m-%d"),
            "MBTI ìŠ¤íƒ€ì¼": style,
            "ë„ì‹œ": city,
            "êµ­ê°€": country,
            "ì•„ì¹¨": morning,
            "ì˜¤í›„": afternoon,
            "ì €ë…": evening,
            "ì‹ì‚¬": meals
        })
    return pd.DataFrame(rows)

def df_to_markdown(df: pd.DataFrame) -> str:
    # ê°„ë‹¨í•œ ë§ˆí¬ë‹¤ìš´ ì¼ì •í‘œ
    lines = ["# ì—¬í–‰ ì¼ì •í‘œ", ""]
    for _, r in df.iterrows():
        lines += [
            f"## {r['ì¼ì']} Â· {r['ë„ì‹œ']} ({r['êµ­ê°€']})",
            f"- {r['ì•„ì¹¨']}",
            f"- {r['ì˜¤í›„']}",
            f"- {r['ì €ë…']}",
            f"- ğŸ½ {r['ì‹ì‚¬']}",
            ""
        ]
    return "\n".join(lines)

# -----------------------------
# ì‚¬ì´ë“œë°”: ì…ë ¥
# -----------------------------
with st.sidebar:
    st.header("âœˆï¸ ì—¬í–‰ ì„¤ì •")
    mbti = st.selectbox("MBTI ì„ íƒ", get_all_mbti(), index=get_all_mbti().index("ENFP") if "ENFP" in get_all_mbti() else 0)
    st.caption(DATA[mbti]["description"])
    day_count = st.slider("ì—¬í–‰ ì¼ìˆ˜", min_value=3, max_value=10, value=5, step=1)
    dest_count = st.slider("ì¶”ì²œ ë„ì‹œ ìˆ˜(ê²½ë¡œ í‘œì‹œ)", min_value=1, max_value=3, value=2, step=1)
    start_date = st.date_input("ì—¬í–‰ ì‹œì‘ì¼", value=date.today())
    random_seed = st.number_input("ëœë¤ ì‹œë“œ(ì¬í˜„ìš©)", min_value=0, value=42, step=1)
    st.markdown("---")
    st.write("ğŸ’¡ íŒ: ì‹œë“œë¥¼ ë°”ê¾¸ë©´ í™œë™ êµ¬ì„±ì´ ë°”ë€Œì–´ìš”!")

random.seed(int(random_seed))

# -----------------------------
# ë©”ì¸: í—¤ë”
# -----------------------------
st.title("ğŸŒ MBTI ìœ í˜•ë³„ ì—¬í–‰ ì¶”ì²œ")
st.subheader(f"{mbti} Â· {DATA[mbti]['style']}")

# ì¶”ì²œ ë„ì‹œ ì„ íƒ & ì§€ë„
sel_dests = sample_destinations(mbti, dest_count)

cols = st.columns([1.2, 1])
with cols[0]:
    fmap = build_map(sel_dests)
    st_folium(fmap, height=520, use_container_width=True)
with cols[1]:
    st.markdown("### ğŸ“ ì¶”ì²œ ë„ì‹œ")
    for (city, country, lat, lon) in sel_dests:
        st.markdown(f"- **{city}**, {country}")
        if city in DEFAULT_IMAGES:
            st.image(DEFAULT_IMAGES[city], use_column_width=True)
    st.info(DATA[mbti]["description"])

# ì¼ì • ìƒì„±
st.markdown("## ğŸ—“ ìë™ ìƒì„± ì—¬í–‰ ì¼ì •")
it_df = generate_itinerary(mbti, day_count, start_date, sel_dests)
st.dataframe(it_df, use_container_width=True)

# ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ (CSV / Markdown)
csv_buf = it_df.to_csv(index=False).encode("utf-8-sig")
md_text = df_to_markdown(it_df).encode("utf-8")

dl_cols = st.columns(2)
with dl_cols[0]:
    st.download_button(
        label="â¬‡ï¸ CSVë¡œ ë‹¤ìš´ë¡œë“œ",
        data=csv_buf,
        file_name=f"{mbti}_ì—¬í–‰ì¼ì •.csv",
        mime="text/csv",
        help="ì—‘ì…€ì—ì„œ ì—´ ìˆ˜ ìˆì–´ìš”"
    )
with dl_cols[1]:
    st.download_button(
        label="â¬‡ï¸ Markdownìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ",
        data=md_text,
        file_name=f"{mbti}_ì—¬í–‰ì¼ì •.md",
        mime="text/markdown",
        help="ë…¸ì…˜/ê¹ƒí—ˆë¸Œ ë“±ì— ë¶™ì—¬ë„£ê¸° ì¢‹ì•„ìš”"
    )

# ì¶”ê°€ ì•ˆë‚´
with st.expander("ğŸ”§ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ ê°€ì´ë“œ"):
    st.markdown("""
- **ë„ì‹œ/í™œë™**ì„ ë” ì¶”ê°€í•˜ë ¤ë©´ `DATA` ë”•ì…”ë„ˆë¦¬ì˜ `destinations`, `activities`ë¥¼ ìˆ˜ì •í•˜ì„¸ìš”.
- **ì§€ë„ì˜ ìŠ¤íƒ€ì¼**ì€ `build_map()`ì˜ `tiles` ê°’ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆì–´ìš”. (ì˜ˆ: "OpenStreetMap", "Stamen Terrain")
- **ì¼ì • ë¡œì§**ì€ `generate_itinerary()`ì—ì„œ ì•„ì¹¨/ì˜¤í›„/ì €ë… ë¸”ë¡ì„ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆí•˜ë©´ ë©ë‹ˆë‹¤.
- **ì´ë¯¸ì§€**ëŠ” `DEFAULT_IMAGES`ì— ë„ì‹œëª… í‚¤ë¡œ URLì„ ì¶”ê°€í•˜ì„¸ìš”.
""")
